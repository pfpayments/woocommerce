(()=>{"use strict";const e=window.React,t=function({paymentMethodConfigurationId:t,eventRegistration:n}){const{onCheckoutSuccess:o,onCheckoutValidation:i}=n,[a,r]=(0,e.useState)(!0),c=`payment-method-${t}`;let s=window.IframeCheckoutHandler(t);const l=(0,e.useCallback)((()=>{s.create(c),r(!1)}),[t,c]);return(0,e.useEffect)((()=>{document.getElementById(c)&&l();const e=o((()=>new Promise((e=>{s.submit(),setTimeout((function(){e(!1)}),3e4)})))),t=i((()=>{let e=new Promise((e=>{s.setValidationCallback((t=>{void 0!==t.success?e(t.success):(console.error("Validation was not successful"),e(!1))}))}));return s.validate(),e}));return()=>{e(),t()}}),[l,c,o,i]),(0,e.createElement)("div",null,a&&(0,e.createElement)("div",null,"Loading payment method..."),(0,e.createElement)("div",{id:c}))},n=function({paymentMethodConfigurationId:t,eventRegistration:n}){const{onCheckoutSuccess:o}=n;(0,e.useEffect)((()=>{const e=o((()=>new Promise(((e,n)=>{window.LightboxCheckoutHandler.startPayment(t,(function(t,o){!t||t.error?n(t):e(t)}))})).catch((e=>{console.error(e),alert("An error occurred during the initialization of the payment lightbox.")}))));return()=>{e()}}),[o,t])};function o({label:t,src:n,alt:o,width:i}){return(0,e.createElement)("div",null," ",t," ",(0,e.createElement)("img",{src:n,alt:o,width:i})," ")}const i=window.wc.wcBlocksRegistry;jQuery((function(a){const r=e=>{const t=JSON.stringify(e);let n=0;for(let e=0;e<t.length;e++)n=(n<<5)-n+t.charCodeAt(e),n|=0;return Math.abs(n).toString(16)},c=wp.apiFetch.nonceEndpoint,s=window.postfinancecheckout_block_params.postfinancecheckout_nonce||"";document.body.classList.contains("woocommerce-checkout")&&a.post(c,{action:"get_payment_methods",postfinancecheckout_nonce:s},(function(l){l.map((function(l){let u;u="iframe"===l.integration_mode?(0,e.createElement)(t,{paymentMethodConfigurationId:l.configuration_id}):(0,e.createElement)(n,{paymentMethodConfigurationId:l.configuration_id});let m=function(e){const t=e.match(/src="([^"]+)"/),n=e.match(/alt="([^"]*)"/),o=e.match(/width="([^"]+)"/);return{src:t?t[1]:"",alt:n?n[1]:"",width:o?o[1]:""}}(l.icon),d={name:l.name,label:(0,e.createElement)(o,{label:l.label,...m}),content:u,edit:(0,e.createElement)("div",null,l.description),ariaLabel:l.ariaLabel,supports:{features:l.supports},canMakePayment:async e=>{let t=r(e),n=l.name+"-"+l.configuration_id+"-"+t,o=(e=>{const t=sessionStorage.getItem(e);if(!t)return null;const n=JSON.parse(t);return(new Date).getTime()>n.expiry?(sessionStorage.removeItem(e),null):n.value})(n);if("iframe"===l.integration_mode){let e=document.getElementById("paymentForm_"+l.configuration_id);e&&(e.src=e.src)}return null!==o?o:await async function(){try{return new Promise(((e,t)=>{const o=document.querySelector("#billing-fields"),i={};o&&o.querySelectorAll("input, select").forEach((e=>{i[e.id]=e.value}));const u=r(i);a.post(c,{action:"is_payment_method_available",payment_method:l.name,configuration_id:l.configuration_id,postfinancecheckout_nonce:s,formHash:u},(function(t){((e,t)=>{const n={value:t,expiry:(new Date).getTime()+36e5};sessionStorage.setItem(e,JSON.stringify(n))})(n,t),e(t)})).fail((function(e){console.error("Error:",e),t(!1)}))}))}catch(e){return console.error("Error:",e),!1}}()}};(0,i.registerPaymentMethod)(d)}))})).fail((function(e){console.error("Error getting payment methods. ",e)}))}))})();