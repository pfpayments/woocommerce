(()=>{"use strict";const e=window.React,t=function({paymentMethodConfigurationId:t,eventRegistration:n}){const{onCheckoutSuccess:o,onCheckoutValidation:a}=n,[i,r]=(0,e.useState)(!0),c=`payment-method-${t}`;let l=window.IframeCheckoutHandler(t);const s=(0,e.useCallback)((()=>{l.create(c),r(!1)}),[t,c]);return(0,e.useEffect)((()=>{document.getElementById(c)&&s();const e=o((()=>new Promise((e=>{l.submit(),setTimeout((function(){e(!1)}),3e4)})))),t=a((()=>{let e=new Promise((e=>{l.setValidationCallback((t=>{void 0!==t.success?e(t.success):(console.error("Validation was not successful"),e(!1))}))}));return l.validate(),e}));return()=>{e(),t()}}),[s,c,o,a]),(0,e.createElement)("div",null,i&&(0,e.createElement)("div",null,"Loading payment method..."),(0,e.createElement)("div",{id:c}))},n=function({paymentMethodConfigurationId:t,eventRegistration:n}){const{onCheckoutSuccess:o}=n;(0,e.useEffect)((()=>{const e=o((()=>new Promise(((e,n)=>{window.LightboxCheckoutHandler.startPayment(t,(function(t,o){!t||t.error?n(t):e(t)}))})).catch((e=>{console.error(e),alert("An error occurred during the initialization of the payment lightbox.")}))));return()=>{e()}}),[o,t])};function o({label:t,src:n,alt:o,width:a}){return(0,e.createElement)("div",null," ",t," ",(0,e.createElement)("img",{src:n,alt:o,width:a})," ")}const a=window.wc.wcBlocksRegistry;(i=>{let r=null;const c=document.getElementById("postfinancecheckout-payment-methods")?.getAttribute("data-json");if(c)try{r=JSON.parse(c)}catch(e){console.error("Error parsing JSON found in HTML:",e)}const l=wp.apiFetch.nonceEndpoint,s=window.postfinancecheckout_block_params?.postfinancecheckout_nonce||"";if(null!=r)m(r),document.getElementById("postfinancecheckout-payment-methods").remove();else{if(""==s)return void console.warn("nonce value not found, we dont' do request to backend");i.post(l,{action:"get_payment_methods",postfinancecheckout_nonce:s},(function(e){m(e)})).fail((function(e,t,n){console.error("Error getting payment methods from backend. Check response body for details.")}))}function m(r){r.map((function(r){let c;c="iframe"===r.integration_mode?(0,e.createElement)(t,{paymentMethodConfigurationId:r.configuration_id}):(0,e.createElement)(n,{paymentMethodConfigurationId:r.configuration_id});let m=function(e){const t=e.match(/src="([^"]+)"/),n=e.match(/alt="([^"]*)"/),o=e.match(/width="([^"]+)"/);return{src:t?t[1]:"",alt:n?n[1]:"",width:o?o[1]:""}}(r.icon),u={name:r.name,label:(0,e.createElement)(o,{label:r.label,...m}),content:c,edit:(0,e.createElement)("div",null,r.description),ariaLabel:r.ariaLabel,supports:{features:r.supports},canMakePayment:async e=>{if("iframe"===r.integration_mode){let e=document.getElementById("paymentForm_"+r.configuration_id);e&&(e.src=e.src)}let t=(e=>{"paymentMethods"in e&&delete e.paymentMethods;const t=JSON.stringify(e);let n=0;for(let e=0;e<t.length;e++)n=(n<<5)-n+t.charCodeAt(e),n|=0;return Math.abs(n).toString(16)})(e),n=r.name+"-"+r.configuration_id+"-"+t,o=(e=>{const t=sessionStorage.getItem(e);if(!t)return null;const n=JSON.parse(t);return(new Date).getTime()>n.expiry?(sessionStorage.removeItem(e),null):n.value})(n);return null!==o?o:await async function(){try{return new Promise(((e,t)=>{i.post(l,{action:"is_payment_method_available",payment_method:r.name,configuration_id:r.configuration_id,postfinancecheckout_nonce:s},(function(t){((e,t)=>{const n={value:t,expiry:(new Date).getTime()+36e5};sessionStorage.setItem(e,JSON.stringify(n))})(n,t),e(t)})).fail((function(e){console.error("Error:",e),t(!1)}))}))}catch(e){return console.error("Error:",e),!1}}()}};(0,a.registerPaymentMethod)(u)}))}})(jQuery)})();